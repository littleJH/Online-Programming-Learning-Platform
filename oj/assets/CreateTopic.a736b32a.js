import{m as e,_ as t,bS as o,a as r,l as s,j as a,S as i,P as l,w as n,cw as c,bG as m}from"./index.5c064301.js";import{P as d}from"./List.9fbede2c.js";import{T as p}from"./TextEditor.53774050.js";import{D as f,r as u,S as j,v as x,N as g,u as h,C as b,a as y}from"./sortable.esm.ccc6074f.js";import{h as v}from"./topic.eb4e8577.js";import{R as S}from"./Readonly.a9ebc692.js";import{s as k}from"./style.module.cb8cfc2a.js";import{I as C}from"./index.7d75d2c2.js";import{T as _}from"./Table.f08b7a7b.js";import{R as I}from"./RedoOutlined.947dad1c.js";import{M as N}from"./index.6891d53f.js";import{R as w}from"./index.4071f4af.js";import{M as T}from"./MinusCircleOutlined.59c26db9.js";import"./problem.1496b552.js";import"./tag.c2520897.js";import"./ProblemTable.523975e8.js";import"./record.df22aa8c.js";import"./progress.2cf02846.js";import"./CheckOutlined.363c4795.js";import"./MyTag.a4f82d92.js";import"./useClosable.e9e9bb76.js";import"./context.aa52cc0c.js";import"./GeneralTable.8195648c.js";import"./style.module.af136287.js";import"./Skeleton.ed2cb458.js";import"./index.bad11826.js";import"./ActionButton.76c967e9.js";import"./useLocale.07149357.js";import"./MyCollapse.32cc964b.js";import"./Collapse.6714be34.js";import"./index.a45f76a6.js";import"./List.6e377c69.js";import"./PurePanel.bec90387.js";import"./index.4e624168.js";import"./index.972659d0.js";import"./index.4cc837d4.js";import"./BaseInput.01760c9b.js";import"./index.ec27075f.js";import"./index.4d9ca8d6.js";import"./index.699f9875.js";import"./Dropdown.acaf0b68.js";import"./Pagination.855f4d50.js";import"./fade.9766c3a1.js";const R=localStorage.getItem("creation_topic_title"),P=localStorage.getItem("creation_topic_content"),M=localStorage.getItem("creation_problem_selected"),O=({children:e,...t})=>{const{attributes:o,listeners:s,setNodeRef:a,setActivatorNodeRef:i,transform:l,transition:m,isDragging:d}=h({id:t["data-row-key"]}),p={...t.style,transform:b.Transform.toString(l&&{...l,scaleY:1}),transition:m,...d?{position:"relative",zIndex:99}:{}};return r("tr",{...t,ref:a,style:p,...o,children:n.Children.map(e,(e=>"sort"===e.key?n.cloneElement(e,{children:r(c,{ref:i,style:{touchAction:"none",cursor:"move"},...s})}):e))})},D=()=>{const n=e.useNavTo(),[c,h]=t.exports.useState(R||""),[b,D]=t.exports.useState(P||""),[E,z]=t.exports.useState(M?JSON.parse(M):[]),[L,A]=t.exports.useState(!1),[J,B]=t.exports.useState(),G=t.exports.useRef(null);t.exports.useEffect((()=>{E.length&&localStorage.setItem("creation_problem_selected",JSON.stringify(E))}),[E]);const H=t.exports.useMemo((()=>[...E.map((e=>e.key))]),[E]),K=t.exports.useCallback((()=>{var e;if(!E.length||!c.length)return c.length||(o.error({message:"请输入标题"}),null==(e=G.current)||e.focus()),void(E.length||o.error({message:"您还没有添加题目"}));const t=JSON.stringify({title:c,content:b,problems:[...E.map((e=>e.key))]});v(t).then((e=>{A(!0),200===e.data.code&&(B({status:"success",title:"创建成功",subTitle:"",extra:[r(s,{type:"primary",onClick:()=>{},children:"查看详情"},"detail"),r(s,{type:"primary",onClick:()=>{},children:"创建下一题"},"next")]}),localStorage.removeItem("creation_topic_title"),localStorage.removeItem("creation_topic_content"),localStorage.removeItem("creation_problem_selected"))}))}),[]),F=m.throttle(K,1e3),W=t.exports.useCallback((e=>{z((t=>[...t.slice(0,e),...t.slice(e+1)]))}),[]);return a("div",{className:k.topicCreation,children:[a("div",{className:k.body,children:[r("div",{className:k.problemList,children:r(d,{mode:"checkbox",selectedProblems:E,setSelectedProblems:z,selectedRowKeys:H})}),r("div",{className:"w-16"}),a(i,{className:k.form,direction:"vertical",size:"large",children:[r(C,{ref:G,autoFocus:!0,placeholder:"标题",style:{},size:"large",value:c,onChange:e=>{h(e.target.value),localStorage.setItem("creation_topic_title",e.target.value)}}),r(p,{mode:"markdown",value:b,htmlChange:e=>{D(e),localStorage.setItem("creation_topic_content",e)},placeholder:"内容..."}),r(f,{modifiers:[u],onDragEnd:({active:e,over:t})=>{e.id!==(null==t?void 0:t.id)&&z((o=>{const r=o.findIndex((t=>t.key===e.id)),s=o.findIndex((e=>e.key===(null==t?void 0:t.id)));return y(o,r,s)}))},children:r(j,{items:E.map((e=>e.key)),strategy:x,children:r(_,{caption:a("h4",{className:"w-full text-start",children:["已选题目",r(I,{className:"mx-4 hover:cursor-pointer",onClick:()=>{z([])}})]}),showHeader:!1,components:{body:{row:O}},size:"small",dataSource:E,locale:{emptyText:r(g,{text:"暂无题目"})},rowKey:"key",columns:[{key:"sort",title:"拖拽排序"},{title:"序号",align:"center",dataIndex:"key",render:(e,t,o)=>r("div",{className:"select-none",children:o+1})},{title:"标题",dataIndex:"title",align:"center",render:(e,t,o)=>r(l,{mouseEnterDelay:.3,title:e,content:r(S,{html:E[o].description}),overlayStyle:{maxWidth:"512px"},overlayInnerStyle:{maxHeight:"256px",overflow:"scroll"},children:r("div",{className:"hover:cursor-pointer",onClick:()=>(e=>{const t=E[e].key;n(`/problem/${t}`)})(o),children:e})})},{dataIndex:"operation",align:"center",render:(e,t,o)=>r(T,{onClick:()=>W(o)})}],pagination:!1})})}),r("div",{className:"flex justify-center",children:r(s,{onClick:()=>F([]),type:"primary",children:"点击创建"})})]})]}),r(N,{open:L,footer:null,onCancel:()=>A(!1),style:{translate:"0 50%"},children:r(w,{...J})})]})};export{D as default};
