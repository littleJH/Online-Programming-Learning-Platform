import{_ as e,a as t,l as a,j as s,d as o,i,m as l,cb as r,cc as n,bG as c,cd as d,R as m,ce as u,t as p,S as f,F as h,bJ as b,bE as v,M as x}from"./index.5c064301.js";import{b as y,c as g,e as j,f as S,h as k,i as N,s as C}from"./problem.1496b552.js";import{s as _}from"./style.module.a7bf0b2a.js";import{C as R,R as O,c as w}from"./CodeEditor.4571c3ba.js";import{c as z,e as E}from"./record.df22aa8c.js";import{M}from"./index.6891d53f.js";import{P as L}from"./progress.2cf02846.js";import{R as P}from"./index.4071f4af.js";import{D as A}from"./index.972659d0.js";import{r as I}from"./recordStates.a45efd0a.js";import{a as $}from"./index.a45f76a6.js";import{U as J}from"./UpOutlined.722986ed.js";import{I as T}from"./index.7d75d2c2.js";import{P as U}from"./PlusOutlined.787b1bb7.js";import"./chatGpt.0470686f.js";import"./LanguageList.5e03f3ce.js";import"./CodeEditorConfig.c1285810.js";import"./index.0c9dd83b.js";import"./context.aa52cc0c.js";import"./row.e491f7a6.js";import"./useLocale.07149357.js";import"./index.7aeb2011.js";import"./BaseInput.01760c9b.js";import"./index.4e624168.js";import"./index.05a8036e.js";import"./index.699f9875.js";import"./Dropdown.acaf0b68.js";import"./PurePanel.bec90387.js";import"./SwapRightOutlined.64619f65.js";import"./ActionButton.76c967e9.js";import"./useClosable.e9e9bb76.js";import"./fade.9766c3a1.js";import"./CheckOutlined.363c4795.js";import"./List.6e377c69.js";const B=o=>{const{problem_id:i,openModal:l,setopenModal:r,state:n,record:c}=o,[d,m]=e.exports.useState(0);e.exports.useEffect((()=>{i&&y(i).then((e=>{m(e.data.data.total)}))}),[i,n]);const u=e.exports.useMemo((()=>Math.floor(n.case_id/d*100)),[n,d]);return t(M,{open:l,title:"",onCancel:()=>r(!1),footer:[t(a,{type:"primary",children:"发布题解"},"tijie"),t(a,{type:"primary",children:"发起讨论"},"taolun")],centered:!0,children:n&&s("div",{className:"flex items-center",children:[t(L,{size:128,type:"circle",percent:u,strokeColor:"#10b981",format:()=>t(P,{icon:null,title:t("div",{className:"text-base",children:n.label}),subTitle:`${null==n?void 0:n.case_id}/${d}`,status:n.state}),style:{marginRight:8}}),s(A,{layout:"vertical",style:{paddingLeft:"4rem",paddingTop:"2rem"},column:2,children:[t(A.Item,{label:"执行时间",children:"未知"}),t(A.Item,{label:"内存消耗",children:"未知"})]})]})})},D={POJ:"00000001",HDU:"00000002",SPOJ:"00000003",VIJOS:"00000004",CF:"00000005",UVA:"00000006",UOJ:"00000007",URAL:"00000008",HACKERRANK:"00000009",ATCODER:"0000000a"},H=new Map;Object.keys(D).forEach((e=>{H.set(D[e],e)}));const K={value:"",label:"待运行",state:"info"},V={value:"Running",label:"运行中",state:"info",case_id:0};let q,F;const G=()=>{var y;const M=o(i),{TextArea:L}=T,P=l.useNavTo(),A=o(r),{id:D}=n(),[G,W]=e.exports.useState(),[X,Q]=e.exports.useState(c.getPathArray(A)[2]),[Y,Z]=e.exports.useState([]),ee=o(d),[te,ae]=e.exports.useState(""),[se,oe]=e.exports.useState(!0),[ie,le]=e.exports.useState("test"),[re,ne]=e.exports.useState(),[ce,de]=e.exports.useState(),[me,ue]=e.exports.useState(K),[pe,fe]=e.exports.useState(V),[he,be]=e.exports.useState(!1),[ve,xe]=e.exports.useState(),[ye,ge]=e.exports.useState(0),je=e.exports.useRef(null),Se=e.exports.useRef(null),ke=e.exports.useRef(null),Ne=m(u),{token:Ce}=p.useToken(),{connectWs:_e}=l.useWsConnect({onOpen:function(){fe(V)},onMessage:function(e){const t=I.find((t=>t.value===e.condition));fe((()=>t?{case_id:e.case_id,...t}:{...V,case_id:e.case_id}))},immediately:!1});e.exports.useLayoutEffect((()=>{ge(Oe())}),[ie,me,se,re]),e.exports.useEffect((()=>{ae(localStorage.getItem(`code-${D}`)||""),q=document.querySelector("#resizebar"),F=document.querySelector("#container")}),[]),e.exports.useEffect((()=>(G&&!M&&Ne(Me()),()=>{Ne("")})),[G,te,ee]),e.exports.useEffect((()=>{window.addEventListener("resize",(()=>{ge(Oe())})),Re()}),[D]);const Re=()=>{D&&Promise.all([g(D),j(D,"true"),j(D,"false"),S(D),k(D),N(D),C(D)]).then((e=>{const t=e[6].data.data;Z(t.caseSamples),ne(t.caseSamples[0].input);const a=t.problem;a.liked=e[0].data.data.like,a.likeNum=e[1].data.data.total,a.dislikeNum=e[2].data.data.total,a.collected=e[3].data.data.collect,a.collectNum=e[4].data.data.total,a.visibleNum=e[5].data.data.total,W(a)}))},Oe=()=>je.current.clientHeight-(Se.current?Se.current.clientHeight:0),we=e=>{q.style.transform="tranfromX()"},ze=()=>{q.removeEventListener("mousemove",we)};const Ee=()=>{setTimeout((()=>{ke.current&&ke.current.scrollIntoView({behavior:"smooth",block:"end"})}),0)},Me=()=>t("div",{className:"flex items-center justify-end px-2 h-12",style:{boxSizing:"border-box"},onClick:Ee,children:s(f,{children:[t(a,{size:"small",type:"dashed",icon:t(se?$:J,{style:{fontSize:"0.75rem"}}),onClick:()=>oe((e=>!e)),children:"控制台"}),t(a,{size:"small",onClick:()=>{oe(!0),le("result"),ue({value:"Running",label:"运行中",state:"info"});const e={language:ee,code:te,input:re,time_limit:null==G?void 0:G.time_limit,memory_limit:null==G?void 0:G.memory_limit};w(JSON.stringify(e)).then((e=>{de(e.data.data)}))},children:"执行代码"}),t(a,{size:"small",onClick:async()=>{const e={language:ee,code:te,problem_id:(null==G?void 0:G.id)||""};localStorage.setItem(`code_${null==G?void 0:G.id}`,te);const t=await z(JSON.stringify(e));if(200===t.data.code){const e=t.data.data.record;_e(E(e.id)),xe(e),be(!0)}},type:"primary",children:"提交"})]})});return s(h,{children:[s("div",{id:"container",className:_.root,style:{backgroundColor:Ce.colorBgBase},children:[s("div",{className:_.left_top,children:[s("div",{className:"h-full flex flex-col",children:[!M&&t("div",{className:"w-full bg-slate-50",children:t(b,{mode:"horizontal",items:[{label:"题目描述",key:"description"},{label:"提交记录",key:"records"},{label:"讨论",key:"comment"},{label:"题解",key:"post"}],onClick:e=>{Q(e.key),P(`${e.key}`)},selectedKeys:[X]})}),t("div",{className:_.content,children:t(v,{context:[G,Y]})})]}),["comment","post"].includes(X)&&t("div",{className:_.add,children:t(a,{size:"large",type:"primary",shape:"circle",onClick:()=>{P(`/creation/${X}?problem_id=${c.getPathArray(A)[1]}`)},children:t(U,{})})})]}),!M&&t("div",{id:"resizebar",className:`h-full w-3 bg-slate-50 flex flex-col justify-center  items-center  hover:bg-slate-300 hover:shadow transition-all duration-300 ${_.resizeBar}`,onMouseDown:e=>{q.addEventListener("mousemove",we)},onMouseUp:ze,onMouseLeave:ze,children:s(f,{direction:"vertical",children:[t(x,{href:"#icon-Scrollvertical"}),t(x,{href:"#icon-Scrollvertical"}),t(x,{href:"#icon-Scrollvertical"})]})}),t("div",{className:_.right_bottom,children:s("div",{ref:je,className:_.ctn,children:[t("div",{className:_.editor,children:t(R,{height:ye,value:te,codeChange:e=>{localStorage.setItem(`code-${D}`,e),ae(e)},oj:(null==D?void 0:D.slice(0,D.indexOf("-")).includes("000000"))?H.get(null==D?void 0:D.slice(0,D.indexOf("-"))):""})}),se&&s("div",{ref:Se,style:{height:"min-content"},children:[t("div",{children:t(b,{selectedKeys:[ie],style:{padding:"0",height:"3rem"},mode:"horizontal",items:[{label:"测试用例",key:"test"},{label:"执行结果",key:"result"}],onClick:e=>{le(e.key),Ee()}})}),t("div",{className:"w-full",children:s("div",{className:"p-4",children:["test"===ie&&t(L,{value:re,autoSize:{minRows:3},onChange:e=>ne(e.target.value)}),"result"===ie&&t(O,{caseSample:{input:re,output:null==(y=Y[0])?void 0:y.output},runResult:ce,currentState:me,setcurrentState:ue})]})})]}),M&&Me()]})}),t("div",{ref:ke})]}),ve&&t(B,{tabMode:X,record:ve,problem_id:null==G?void 0:G.id,openModal:he,setopenModal:be,state:pe})]})};export{G as Detail,G as default};
