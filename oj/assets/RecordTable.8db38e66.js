import{_ as e,a as t,bw as a,j as r,M as n,q as s,l as i,c as o,bF as l,c8 as c,d,n as p}from"./index.5c064301.js";import{g as u,h,a as m}from"./record.df22aa8c.js";import{g as f,h as v}from"./competitionMixture.e039dd24.js";import{r as x}from"./recordStates.a45efd0a.js";import{T as b}from"./index.7d75d2c2.js";import{H as g}from"./Highlight.c2b7293d.js";import{s as S,b as k}from"./problem.1496b552.js";import{g as y}from"./problemNew.e9465bc1.js";import{G as w}from"./GeneralTable.8195648c.js";import{M as C}from"./index.6891d53f.js";import{R as j}from"./index.4071f4af.js";import{S as N}from"./index.77ceaa6f.js";import{D as I}from"./index.972659d0.js";const _=r=>{const[n,s]=e.exports.useState("bg-slate-500"),[i,o]=e.exports.useState("");return e.exports.useEffect((()=>{x.forEach((e=>{if(r.value===e.value)switch(o(e.label),e.state){case"error":s("bg-red-500");break;case"warning":s("bg-yellow-500");break;case"success":s("bg-green-500")}}))}),[]),t("div",{className:"flex justify-center select-none mx-4",children:t(a,{title:i,children:t("div",{className:`${n} py-1 px-2 text-white rounded`,style:{width:"128px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.value})})})};new Map([...new Map([["XML","xml"],["PHP","php"],["C#","csharp"],["C++","cpp"],["Razor","razor"],["Markdown","markdown"],["Diff","diff"],["Java","java"],["VB","vb"],["CoffeeScript","coffeescript"],["Handlebars","handlebars"],["Batch","batch"],["Pug","pug"],["F#","f#"],["Lua","lua"],["Powershell","powershell"],["Python","python"],["Ruby","ruby"],["SASS","sass"],["R","r"],["Objective-C","objective-c"]]),...new Map([["TypeScript","typescript"],["JavaScript","javascript"],["CSS","css"],["LESS","less"],["SCSS","scss"],["JSON","json"],["HTML","html"]])]);const H=e=>{const a=[];return e.forEach((e=>{a.push({label:r("div",{className:"flex items-center",children:[t("span",{className:"flex items-center",children:t(n,{size:2,href:`#icon-${s.includes(e)?"cpp":e}`})}),t("span",{className:"mx-4",children:e})]}),value:e})})),a},M=H(["C","CSharp","C++","C++11","C++14","C++17","C++20","Erlang","Go","Java","JavaScript","Kotlin","Pascal","php","Python","Ruby","Rust","Swift"]);H(["C++","C","Java","fortran","pascal"]),H([]);const E=e=>{var a;return t("div",{className:"flex justify-center",children:null==(a=M.find((t=>t.value===e.value)))?void 0:a.label})},R=e=>{const{record:a,hackInput:n,sethackInput:s,userInfo:o,submit:l,loading:c}=e;return r("div",{children:[r("div",{children:[r("div",{className:"flex justify-between",children:[t("div",{className:"hover:text-blue-500 hover:cursor-pointer hover:underline",children:null==o?void 0:o.name}),t("div",{children:a.created_at})]}),t(g,{code:a.code})]}),t(b,{value:n,onChange:e=>s(e.target.value)}),t("div",{className:"flex justify-center mt-8",children:t(i,{loading:c,type:"primary",onClick:()=>l(),children:"Hack"})})]})},P=o({baseURL:"hack"}),z=a=>{const{hack:n,record:s}=a,[i,o]=e.exports.useState({}),[d,p]=e.exports.useState({});return e.exports.useEffect((()=>{S(null==s?void 0:s.problem_id).then((e=>{o(e.data.data.problem)})),l(n.user_id).then((e=>{p(e.data.data.user)}))}),[s]),r("div",{children:[r("p",{className:"flex",children:[t("div",{children:"作者："}),t(c,{className:"hover:cursor-pointer",to:"",children:d.name})]}),r("p",{className:"flex",children:[t("div",{children:"题目："}),t(c,{className:"hover:cursor-pointer",to:`/problem/${i.id}`,children:i.title})]}),r("p",{className:"",children:[t("div",{children:"Hack Input："}),t("div",{className:"border border-solid border-slate-500 rounded p-4 my-2",children:n.input})]}),t(g,{code:s.code})]})},J="_recordTable_15znn_1",O=a=>{const{mode:s,problem:i,competition:o}=a,c=d(p),[b,g]=e.exports.useState(),S=e.exports.useRef([]),[H,M]=e.exports.useState([]),[O,L]=e.exports.useState(),[T,$]=e.exports.useState(""),[F,G]=e.exports.useState(!1),[A,B]=e.exports.useState(!1),[D,q]=e.exports.useState(!1),[K,U]=e.exports.useState(),[V,W]=e.exports.useState(),[X,Q]=e.exports.useState([]),[Y,Z]=e.exports.useState(),[ee,te]=e.exports.useState(!1),[ae,re]=e.exports.useState([]);e.exports.useEffect((()=>{ne(),se()}),[i,o,s]),e.exports.useEffect((()=>{ie()}),[O]);const ne=()=>{i&&k(i.id).then((e=>{Z(e.data.data.total)}))},se=async()=>{let e=i;if("problem"===s&&i){const e=await u({problem_id:i.id});S.current=e.data.data.records}if("competition"===s&&o){const e=await f(o.type,o.id,{});S.current=e.data.data.records}let a="unableHack";const r=[];for(let n of S.current){if("problem"===s&&i&&(a=await oe(i.input_check_id,n)),"competition"===s){const t=(await y(n.problem_id)).data.data.problem;e=t,a=await oe(t.input_check_id,n),re((e=>{let a=!1;return e.forEach((e=>{e.text===t.title&&(a=!0)})),a?[...e]:[...e,{text:t.title,value:t.title}]}))}r.push({key:n.id,condition:t(_,{value:n.condition}),create_at:n.created_at,language:t(E,{value:n.language}),pass:n.pass,problem:e,hack:a})}M(r)},ie=()=>{O&&l(O.user_id).then((e=>{g(e.data.data.user)}))},oe=async(e,t)=>{if(e.indexOf("0000")&&"Accepted"===t.condition){const e=await(a=t.hack_id,P.get(`/show/${a}`));return 400===e.data.code?"notHack":200===e.data.code?(U(e.data.data.hack),"hacked"):"unableHack"}return"unableHack";var a},le=e.exports.useMemo((()=>{const e=[];return null==X||X.forEach((t=>{e.push({key:String(t.cid),input:t.input,time:t.time,memory:t.memory})})),e}),[X]),ce=[{align:"center",dataIndex:"condition",title:"提交状态"},{align:"center",dataIndex:"language",title:"语言"},{align:"center",dataIndex:"pass",title:"通过用例"},{align:"center",dataIndex:"create_at",title:"提交时间"},{align:"center",dataIndex:"hack",title:"骇客",render:(e,a)=>{switch(e){case"notHack":return t("div",{className:"hover:cursor-pointer",onClick:e=>{e.stopPropagation(),L(S.current.find((e=>e.id=a.key))),q(!0)},children:t(n,{href:"hackster",size:2})});case"hacked":return t("div",{className:"hover:cursor-pointer",onClick:e=>{e.stopPropagation(),L(S.current.find((e=>e.id=a.key))),B(!0)},children:t(n,{href:"choose",size:1.5})})}}}],de={dataSource:H,columns:"competition"===s?[...[{align:"center",dataIndex:["problem","title"],title:"题目",filters:ae,onFilter:(e,t)=>0===t.problem.title.indexOf(e),filterMultiple:!0,render:(e,a)=>t("div",{className:"hover:cursor-pointer",onClick:()=>{L(S.current.find((e=>e.id=a.key))),G(!0)},children:e})}],...ce]:ce,style:{minWidth:"max-content"},onRow:e=>({onClick:()=>(e=>{const t=S.current.find((t=>t.id===e.key));W((()=>x.find((e=>e.value===t.condition)))),m(e.key).then((e=>{200===e.data.code?Q(e.data.data.cases):Q([])})),G(!0)})(e)})},pe={dataSource:le,columns:[{align:"center",dataIndex:"input",title:"用例输入"},{align:"center",dataIndex:"time",title:"执行时间",render:e=>r("span",{children:[e,"（ms）"]})},{align:"center",dataIndex:"memory",title:"内存消耗",render:e=>r("span",{children:[e,"（kb）"]})}]};return r("div",{className:J,children:[t("div",{}),t(w,{...de}),t(C,{width:"800px",title:"骇客提交",open:D,footer:[],onCancel:()=>q(!1),children:b&&O&&t(R,{record:O,hackInput:T,sethackInput:$,userInfo:b,submit:()=>{te(!0);const e=JSON.stringify({input:T});function t(e){200===e.data.code?c&&c.success({message:e.data.msg}):c&&c.warning({message:e.data.msg})}"problem"===s&&O&&h(O.id,e).then(t).finally((()=>te(!1))),"competition"===s&&O&&o&&v(null==o?void 0:o.type,O.id,e).then(t).finally((()=>te(!1)))},loading:ee})}),t(C,{centered:!0,title:"骇客详情",open:A,width:"800px",footer:[],onCancel:()=>B(!1),children:K&&O&&t(z,{hack:K,record:O})}),r(C,{centered:!0,open:F,onCancel:()=>G(!1),footer:null,children:[t("pre",{children:t("code",{children:null==O?void 0:O.code})}),t(j,{status:null==V?void 0:V.state,title:null==V?void 0:V.label,extra:0!==X.length&&t(N,{title:"通过测试用例数",value:"success"===(null==V?void 0:V.state)?X.length:X.length-1,suffix:`/${Y}`})}),"success"===(null==V?void 0:V.state)&&t(w,{...pe}),"error"===(null==V?void 0:V.state)&&0!==X.length&&r(I,{title:"未通过用例",size:"small",layout:"vertical",column:2,bordered:!0,children:[t(I.Item,{label:"用例输入",children:X[X.length-1].input}),t(I.Item,{label:"用例输出",children:X[X.length-1].output}),r(I.Item,{label:"执行时间",children:[X[X.length-1].time,"（ms）"]}),r(I.Item,{label:"内存消耗",children:[X[X.length-1].memory,"（ms）"]})]})]})]})};export{O as R};
