import{g as e,a as t}from"./topic.eb4e8577.js";import{T as a}from"./TextEditor.53774050.js";import{I as s,S as r}from"./index.7d75d2c2.js";import{d as i,i as o,m as l,_ as n,a as d,l as c,j as m,w as p,cw as u,F as h}from"./index.5c064301.js";import{k as f}from"./group.ab80a5d7.js";import{D as y,r as x,S as k,v as b,N as g,u as j,C as v,a as w}from"./sortable.esm.ccc6074f.js";import{c as C}from"./form.7b4dfe6a.js";import{s as I}from"./style.module.cb8cfc2a.js";import{F as S}from"./index.0c9dd83b.js";import{T as N}from"./Table.f08b7a7b.js";import{S as T}from"./index.05a8036e.js";import{I as F}from"./index.7aeb2011.js";import{M as E}from"./index.6891d53f.js";import{R as P}from"./index.4071f4af.js";import{D as _}from"./index.79a1b64c.js";import{M as D}from"./MinusCircleOutlined.59c26db9.js";import{P as R}from"./PlusOutlined.787b1bb7.js";import"./index.4cc837d4.js";import"./context.aa52cc0c.js";import"./index.4e624168.js";import"./BaseInput.01760c9b.js";import"./row.e491f7a6.js";import"./useLocale.07149357.js";import"./List.6e377c69.js";import"./index.a45f76a6.js";import"./PurePanel.bec90387.js";import"./CheckOutlined.363c4795.js";import"./index.ec27075f.js";import"./index.4d9ca8d6.js";import"./index.699f9875.js";import"./Dropdown.acaf0b68.js";import"./Pagination.855f4d50.js";import"./UpOutlined.722986ed.js";import"./ActionButton.76c967e9.js";import"./useClosable.e9e9bb76.js";import"./fade.9766c3a1.js";const V=({children:e,...t})=>{const{attributes:a,listeners:s,setNodeRef:r,setActivatorNodeRef:i,transform:o,transition:l,isDragging:n}=j({id:t["data-row-key"]}),c={...t.style,transform:v.Transform.toString(o&&{...o,scaleY:1}),transition:l,...n?{position:"relative",zIndex:99}:{}};return d("tr",{...t,ref:r,style:c,...a,children:p.Children.map(e,(e=>"sort"===e.key?p.cloneElement(e,{children:d(u,{ref:i,style:{touchAction:"none",cursor:"move"},...s})}):e))})},z=()=>{const p=i(o),u=l.useNavTo(),[j]=S.useForm(),[v,z]=n.exports.useState("close"),[M,O]=n.exports.useState([]),[q,B]=n.exports.useState([]),[K,A]=n.exports.useState(""),[H,L]=n.exports.useState(""),[W,J]=n.exports.useState([]),[U,Y]=n.exports.useState([]),$=n.exports.useRef(null),[G,Q]=n.exports.useState(!1),[X,Z]=n.exports.useState(),[ee,te]=n.exports.useState(!1);n.exports.useEffect((()=>{var e;null==(e=$.current)||e.focus(),re(),ie()}),[]);const ae=n.exports.useMemo((()=>W.map((e=>e.id))),[W]),se=n.exports.useMemo((()=>U.map((e=>e.id))),[U]);n.exports.useEffect((()=>{j.setFieldValue("topics",ae),j.setFieldValue("groups",se)}),[ae,se]);const re=n.exports.useCallback((()=>{e(1,99999).then((e=>{const a=[];e.data.data.topics.forEach((async e=>{const s=await t(e.id,1,0);a.push({...e,key:e.id,total:s.data.data.total})})),O(a)}))}),[]),ie=n.exports.useCallback((()=>{f(1,99999).then((e=>{const t=[];e.data.data.groups.forEach((e=>{t.push({...e,key:e.id})})),B(t)}))}),[]),oe=e=>{},le=n.exports.useCallback(((e,t,a)=>{switch(v){case"topics":"all"===a.type&&(e.length?J((e=>[...e,...t])):J((e=>[...e.filter((e=>-1===M.findIndex((t=>t.key===e.key))))])));break;case"groups":"all"===a.type&&(e.length?Y((e=>[...e,...t])):Y((e=>[...e.filter((e=>-1===q.findIndex((t=>t.key===e.key))))])))}}),[M,q,v]),ne=n.exports.useCallback(((e,t)=>{switch(v){case"topics":J(t?t=>[...t,e]:t=>[...t.filter((t=>t.key!==e.key))]);break;case"groups":Y(t?t=>[...t,e]:t=>[...t.filter((t=>t.key!==e.key))])}}),[v]),de=({active:e,over:t},a)=>{switch(a){case"topics":e.id!==(null==t?void 0:t.id)&&J((a=>{const s=a.findIndex((t=>t.key===e.id)),r=a.findIndex((e=>e.key===(null==t?void 0:t.id)));return w(a,s,r)}));break;case"groups":e.id!==(null==t?void 0:t.id)&&Y((a=>{const s=a.findIndex((t=>t.key===e.id)),r=a.findIndex((e=>e.key===(null==t?void 0:t.id)));return w(a,s,r)}))}},ce=n.exports.useCallback(((e,t)=>{switch(t){case"topics":J((t=>[...t.slice(0,e),...t.slice(e+1)]));break;case"groups":Y((t=>[...t.slice(0,e),...t.slice(e+1)]))}}),[]),me=n.exports.useCallback((()=>{j.validateFields().then((e=>{C(JSON.stringify(e)).then((e=>{200===e.data.code?Z({status:"success",title:"创建成功",subTitle:"",extra:[d(c,{type:"primary",onClick:()=>{},children:"查看详情"},"detail"),d(c,{type:"primary",onClick:()=>{j.resetFields(),Q(!1),Y([]),J([]),L(""),z("close")},children:"继续创建"},"next")]}):Z({status:"error",title:"创建失败",subTitle:m("div",{children:[d("p",{children:e.data.msg}),d("p",{children:"组员数量大于限制或者成员是否重复"})]})}),Q(!0)}))})).catch((e=>{}))}),[j]),pe=n.exports.useCallback((e=>{u(`/problem/set/all?topic=${e.id}&text=&labels=`)}),[]),ue=()=>d(h,{children:"close"!==v&&m("div",{className:I.leftBox,children:[d(r,{style:{padding:"1rem 0"},placeholder:"搜索题单",defaultValue:K,enterButton:!0,onSearch:oe,onChange:e=>{A(e.target.value)}}),"topics"===v&&d(N,{rowSelection:{columnWidth:64,selectedRowKeys:ae,onChange:(e,t,a)=>le(e,t,a),onSelect:(e,t)=>ne(e,t)},size:"small",dataSource:M,pagination:!1,columns:[{dataIndex:"title",key:"title",title:"题单"},{dataIndex:"content",key:"content",title:"描述",render:e=>d("div",{style:{},children:e.replace(/<[^<>]+>/g,"")})},{dataIndex:"total",key:"total",title:"题数"},{key:"action",title:"操作",render:(e,t,a)=>d(c,{type:"link",onClick:()=>pe(t),children:"详情"})}]}),"groups"===v&&d(N,{rowSelection:{columnWidth:64,selectedRowKeys:se,onChange:(e,t,a)=>le(e,t,a),onSelect:(e,t)=>ne(e,t)},size:"small",dataSource:q,pagination:!1,columns:[{dataIndex:"title",key:"title",title:"用户组"},{dataIndex:"content",key:"content",title:"描述",render:e=>d("div",{style:{},children:e.replace(/<[^<>]+>/g,"")})},{key:"action",title:"操作",render:(e,t)=>d(c,{type:"link",children:" 详情"})}]})]})});return m("div",{className:I.formCreation,children:[m("div",{className:I.body,children:[d("div",{className:I.left,children:!p&&ue()}),d("div",{className:"w-8"}),m("div",{className:I.right,children:[m(S,{form:j,name:"formForm",layout:"vertical",onValuesChange:e=>{},scrollToFirstError:!0,initialValues:{auto_update:!0,auto_pass:!1,pass_re:!1},children:[d(S.Item,{name:"title",label:"标题：",rules:[{required:!0}],children:d(s,{ref:$})}),d(S.Item,{name:"content",label:"描述",rules:[{required:!0}],children:d(a,{value:H,mode:"markdown",htmlChange:e=>{L(e),j.setFieldValue("content","<p><br></p>"===e||""===e?void 0:e)}})}),m(S.Item,{name:"topics",label:"题单：",rules:[{required:!0}],children:[d(y,{modifiers:[x],onDragEnd:e=>de(e,"topics"),children:d(k,{items:U.map((e=>e.key)),strategy:b,children:d(N,{pagination:!1,showHeader:!1,components:{body:{row:V}},rowKey:"key",size:"small",dataSource:W,columns:[{key:"sort",width:32},{width:64,dataIndex:"key",render:(e,t,a)=>d("div",{className:"select-none",children:a+1})},{dataIndex:"title",key:"title"},{dataIndex:"operation",align:"right",render:(e,t,a)=>d(D,{onClick:()=>ce(a,"topics")})}],locale:{emptyText:d(g,{text:"暂无数据"})}})})}),d("div",{className:"flex justify-center w-full",children:d(c,{type:"dashed",style:{margin:"1rem"},onClick:()=>{te(!0),z("topics")},children:d(R,{style:{width:"4rem"}})})})]}),m(S.Item,{name:"groups",label:"用户组：",children:[d(y,{modifiers:[x],onDragEnd:e=>de(e,"groups"),children:d(k,{items:W.map((e=>e.key)),strategy:b,children:d(N,{pagination:!1,showHeader:!1,rowKey:"key",components:{body:{row:V}},size:"small",dataSource:U,columns:[{key:"sort",width:32},{width:64,dataIndex:"key",render:(e,t,a)=>d("div",{className:"select-none",children:a+1})},{dataIndex:"title",key:"title"},{dataIndex:"operation",align:"right",render:(e,t,a)=>d(D,{onClick:()=>ce(a,"groups")})}],locale:{emptyText:d(g,{text:"暂无数据"})}})})}),d("div",{className:"flex justify-center w-full",children:d(c,{type:"dashed",style:{margin:"1rem"},onClick:()=>{te(!0),z("groups")},children:d(R,{style:{width:"4rem"}})})})]}),d(S.Item,{name:"auto_update",label:"每小时更新排名：",valuePropName:"checked",children:d(T,{defaultChecked:!0})}),d(S.Item,{name:"auto_pass",label:"自动通过用户组申请：",valuePropName:"checked",children:d(T,{})}),d(S.Item,{name:"pass_num",label:"用户组成员数量限制：",rules:[{required:!0}],children:d(F,{min:1})}),d(S.Item,{name:"pass_re",label:"用户组成员可重复：",valuePropName:"checked",children:d(T,{})})]}),d("div",{className:"text-center",children:d(c,{type:"primary",style:{margin:"1rem 0"},onClick:me,children:"点击创建"})})]})]}),d(E,{open:G,footer:null,onCancel:()=>Q(!1),style:{translate:"0 50%"},children:d(P,{...X})}),p&&d(_,{open:ee,placement:"right",onClose:()=>te(!1),children:ue()})]})};export{z as default};
