import{c as e,d as t,i as a,m as s,bI as o,_ as r,j as i,a as l,F as c,l as n,bG as d,S as m,bm as p,bS as g}from"./index.5c064301.js";import{j as u,h as f,u as h,k as y,l as j}from"./article.08f59da4.js";import{D as x}from"./Dragger.eac806ba.js";import{u as b}from"./img.76472ab1.js";import{T as S}from"./TextEditor.53774050.js";import{s as v}from"./style.module.cb8cfc2a.js";import{C as _}from"./index.9225dd62.js";import{I as w}from"./index.7d75d2c2.js";import{S as N}from"./index.a45f76a6.js";import"./context.aa52cc0c.js";import"./fade.9766c3a1.js";import"./progress.2cf02846.js";import"./CheckOutlined.363c4795.js";import"./useLocale.07149357.js";import"./index.4cc837d4.js";import"./Skeleton.ed2cb458.js";import"./PlusOutlined.787b1bb7.js";import"./Dropdown.acaf0b68.js";import"./index.4e624168.js";import"./BaseInput.01760c9b.js";import"./List.6e377c69.js";import"./PurePanel.bec90387.js";const C=e({baseURL:"category"}),I=localStorage.getItem("creation_article_title"),$=localStorage.getItem("creation_article_content"),k=()=>{const e=t(a),k=s.useNavTo(),[z,L]=o(),[O,D]=r.exports.useState(""),[E,F]=r.exports.useState(""),[J,P]=r.exports.useState([]),[T,M]=r.exports.useState(""),[R,U]=r.exports.useState(),[B,G]=r.exports.useState(""),[q,A]=r.exports.useState([]),H=z.get("article_id"),K=r.exports.useMemo((()=>J.map((e=>({label:e})))),[J]);r.exports.useEffect((()=>{H?(u(H).then((e=>{const t=e.data.data.article;if(D(t.title),F(t.content),M(t.category_id),""!==t.res_long){const e=JSON.parse(t.res_long).img;e&&G(e)}})),f(H).then((e=>{const t=e.data.data.articleLabels;0!==t.length&&P(t.map((e=>e.label)))}))):(D(I||""),F($||"")),((e=1,t=20)=>C.get(`/list?pageNum=${e}&pageSize=${t}`))().then((e=>{U(e.data.data.categorys)}))}),[]);const Q=r.exports.useMemo((()=>{const e=[];return null==R||R.forEach((t=>e.push({value:t.id,label:t.name}))),e}),[R]),V=d.throttle((async()=>{if(""===O||""===E)return void g.warning({message:"标题/正文不能为空"});const e=async e=>{const t=e.data.data.article;if(200===e.data.code){D(""),F(""),localStorage.removeItem("creation_article_title"),localStorage.removeItem("creation_article_content");for(let e of J){const a=await j(t.id,e);200!==(null==a?void 0:a.data.code)&&g.warning({message:`标签${e}创建失败`,description:null==a?void 0:a.data.msg})}k(`/community/article/${t.id}`)}else g.warning({message:`文章${H?"更新":"发布"}失败`,description:e.data.msg})},t=JSON.stringify({title:O,content:E,category:T,res_long:""!==B?JSON.stringify({img:B}):""});e(H?await h(H,t):await y(t))}),1e3),W=e=>{D(e.target.value),localStorage.setItem("creation_article_title",e.target.value)},X=e=>{(async e=>{e.status="uploading",A([e]);const t=new FormData;t.append("file",e);const{data:{code:a,data:s,msg:o}}=await b(t);200===a&&(e.status="done",e.url=`${p}/${s.Icon}`,G(`${s.Icon}`),A([e]))})(e)},Y=()=>{A([]),G("")},Z=()=>l("div",{className:v.formCard,children:i(m,{className:"w-full",direction:"vertical",size:"large",children:[l(w,{autoFocus:!0,placeholder:"标题",style:{},size:"large",value:O,onChange:W}),l(N,{allowClear:!0,size:"large",mode:"tags",style:{display:"block"},placeholder:"创建标签",onChange:e=>P(e),options:K,value:J}),l(N,{placeholder:"选择分类",size:"large",style:{display:"block"},options:Q,onSelect:e=>M(e)}),l(x,{style:{width:"100%"},className:"text-slate-500",name:"file",beforeUpload:X,onRemove:Y,fileList:q,children:""!==B?l("img",{src:`${p}/${B}`,alt:"封面",style:{width:"100%"}}):l("div",{className:"my-16",children:"拖拽或点击上传“封面”"})}),!e&&l("div",{className:"flex justify-center",children:l(n,{onClick:()=>V([]),type:"primary",children:H?"更新":"发布"})})]})});return i("div",{className:v.articleCreation,children:[e&&Z(),l(_,{size:"small",className:v.contentCard,styles:{body:{padding:"0px",height:"100%"}},children:l(S,{mode:"richtext",value:E,htmlChange:e=>(e=>{F(e),localStorage.setItem("creation_article_content",e)})(e),placeholder:"开始你的创作~~~"})}),!e&&l(c,{children:Z()}),e&&l("div",{className:"flex justify-center mt-8",children:l(n,{onClick:()=>V([]),type:"primary",children:H?"更新":"发布"})})]})};export{k as default};
