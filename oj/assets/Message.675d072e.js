import{g as e,c as s}from"./message.856d7a68.js";import{d as t,e as a,n as r,_ as o,t as i,bF as n,j as d,a as l,F as c,D as m,l as u,bG as p}from"./index.5c064301.js";import{s as f}from"./style.module.b5b5c35b.js";import{M as h}from"./MyAvatar.22457dcc.js";import{L as j}from"./index.0ec24622.js";import{I as x}from"./index.7d75d2c2.js";import{C as v}from"./index.9225dd62.js";import"./Pagination.855f4d50.js";import"./context.aa52cc0c.js";import"./index.a45f76a6.js";import"./List.6e377c69.js";import"./PurePanel.bec90387.js";import"./index.4e624168.js";import"./useLocale.07149357.js";import"./CheckOutlined.363c4795.js";import"./row.e491f7a6.js";import"./BaseInput.01760c9b.js";import"./Skeleton.ed2cb458.js";import"./PlusOutlined.787b1bb7.js";import"./Dropdown.acaf0b68.js";const b=()=>{const b=t(a);t(r);const[g,y]=o.exports.useState([]),[w,k]=o.exports.useState(""),[_,I]=o.exports.useState(!1),L=o.exports.useRef(null),{token:P}=i.useToken();o.exports.useEffect((()=>{S()}),[]);const S=async()=>{if(b)try{const s=[],t=(await e(null==b?void 0:b.id,1,20)).data.data.messages;for(let e of t){const t=(await n(e.user_id)).data.data.user;s.push({...e,user:t})}y(s.reverse())}catch{}},C=e=>{const s=e.author_id===(null==b?void 0:b.id);return d("div",{className:"w-full flex justify-"+(s?"end":"start"),children:[!s&&l(h,{user:e.user}),l("div",{style:{maxWidth:"75%"},children:l(v,{size:"small",style:{margin:"0 1rem",backgroundColor:`${s?P.colorPrimaryBg:""}`},children:l("div",{dangerouslySetInnerHTML:{__html:p.getHtmlFromMd(e.content)}})})}),s&&l(h,{user:e.user})]})},M=async()=>{if(b)try{I(!0);200===(await s(b.id,w)).data.code&&(S(),k(""))}finally{I(!1)}};return d("div",{className:f.message,children:[l("div",{className:f.messageList,children:l("div",{ref:L,children:l(j,{split:!1,dataSource:g,renderItem:(e,s)=>l(c,{children:e&&l(j.Item,{onLoad:()=>{var e;s===g.length-1&&(null==(e=L.current)||e.scrollIntoView({behavior:"smooth",block:"end"}))},children:C(e)},`${e.author_id}${e.created_at}`)})})})}),l(m,{}),d("div",{children:[l(x.TextArea,{rows:4,value:w,onChange:e=>k(e.target.value),onPressEnter:e=>{e.preventDefault(),_||M()}}),l("p",{className:"text-end",children:l(u,{type:"primary",onClick:M,loading:_,children:"发送"})})]})]})};export{b as default};
