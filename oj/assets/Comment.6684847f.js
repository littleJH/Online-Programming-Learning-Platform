import{c as e,aZ as t,_ as a,bG as o,bF as s,a as r,l as i,j as d,m,d as l,cb as n,cj as c,t as p}from"./index.5c064301.js";import{L as u}from"./LoadMoreList.3dfd533d.js";import{s as f}from"./style.module.a7bf0b2a.js";import{g as j,a as y,b,c as h}from"./comment.ebb40c5a.js";import{G as x}from"./GeneralCard.8772c459.js";import{R as k}from"./Readonly.a9ebc692.js";import{R as g}from"./RemarkCard.b0fdd9fd.js";import{T as C}from"./TextEditor.53774050.js";import{C as v}from"./index.9225dd62.js";import{M as w}from"./index.6891d53f.js";import"./Skeleton.ed2cb458.js";import"./index.0ec24622.js";import"./Pagination.855f4d50.js";import"./context.aa52cc0c.js";import"./index.a45f76a6.js";import"./List.6e377c69.js";import"./PurePanel.bec90387.js";import"./index.4e624168.js";import"./useLocale.07149357.js";import"./CheckOutlined.363c4795.js";import"./row.e491f7a6.js";import"./index.bad11826.js";import"./ActionButton.76c967e9.js";import"./MyTag.a4f82d92.js";import"./useClosable.e9e9bb76.js";import"./style.module.dc2582af.js";import"./MyAvatar.22457dcc.js";import"./index.4cc837d4.js";import"./remark.4a43720f.js";import"./PlusOutlined.787b1bb7.js";import"./Dropdown.acaf0b68.js";import"./fade.9766c3a1.js";const P=e({baseURL:"reply"}),S=(e,t=1,a=20)=>P.get(`/list/${e}?pageNum=${t}&pageSize=${a}`),R=e=>{var m;const{commentProps:l,onClick:n,mode:c="default",showReply:p,style:u}=e,[f,b]=a.exports.useState(l),[h,R]=a.exports.useState(""),[L,M]=a.exports.useState(!1),N=a.exports.useMemo((()=>{const{num:e,unit:t}=o.getTimeAgo(f.created_at);return`${e}${t}前`}),[f]);a.exports.useEffect((()=>{T()}),[]);const T=async()=>{try{const e={...l},t=await Promise.all([j(l.id),y(l.id),s(l.user_id)]);e.liked=t[0].data.data.like,e.likeNum=t[1].data.data.total,e.user=t[2].data.data.user,e.reply=p?(await S(l.id)).data.data:null,b(e)}catch{}};return r(v,{style:u,size:"small",children:r(x,{user:null==f?void 0:f.user,liked:{count:f.likeNum,isLiked:f.liked},content:r(k,{html:f.content}),ago:N,footer:f.reply?r(i,{type:"dashed",size:"small",onClick:()=>M(!0),children:"# 我有一言"}):null,extra:p?d("div",{children:[d("div",{children:[d("h4",{children:["回复 (",r("span",{children:(null==(m=f.reply)?void 0:m.total)||0}),")"]}),f.reply&&f.reply.replys.map(((e,t)=>r(g,{remark:e},e.id)))]}),r(w,{open:L,onCancel:()=>M(!1),footer:[r(i,{type:"primary",onClick:()=>{var e,a;(e=f.id,a=JSON.stringify({content:h}),P.post(`/create/${e}`,a,t())).then((async e=>{if(200===e.data.code){M(!1),R("");const{data:e}=await S(f.id);b((t=>({...t,reply:e.data})))}}))},children:"发布"},"submit")],title:"我有一言",children:r(C,{mode:"markdown",value:h,htmlChange:e=>R(e),placeholder:"发表我的看法~~~"})})]}):null})})},L=()=>{m.useNavTo();const e=l(n),t=l(c),[s,i]=a.exports.useState([]),[d,j]=a.exports.useState(0),{token:y}=p.useToken(),x=a.exports.useMemo((()=>(i([]),async(t,a,s)=>{try{const r=[],d=(await b(o.getPathArray(e)[1],t,a)).data.data;for(let e of d.comments)r.push((await h(e.Member)).data.data.comment);i((e=>e?[...e,...r]:r)),j(d.total),s()}catch{}})),[t]);return r("div",{className:f.comment,children:r(u,{dataSource:s,total:d,fetchFn:x,split:!1,itemRender:e=>r(R,{style:{backgroundColor:y.colorPrimaryBg,marginBottom:"2rem"},commentProps:e,showReply:!0})})})};export{L as default};
