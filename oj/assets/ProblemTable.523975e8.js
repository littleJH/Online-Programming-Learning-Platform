import{_ as e,t,j as a,a as o,d as l,n as s,i as r,l as i,F as n,D as c,bw as d,bG as p}from"./index.5c064301.js";import{g as m}from"./record.df22aa8c.js";import{a as h}from"./problem.1496b552.js";import{P as f}from"./progress.2cf02846.js";import{M as y}from"./MyTag.a4f82d92.js";import{G as u}from"./GeneralTable.8195648c.js";import{s as x}from"./style.module.af136287.js";import{S as g}from"./Skeleton.ed2cb458.js";import{P as b}from"./index.bad11826.js";const k=l=>{const{total:s,accept:r}=l,[i,n]=e.exports.useState(),{token:c}=t.useToken();e.exports.useLayoutEffect((()=>{n(0!==s)}),[s,r]);const d=e.exports.useMemo((()=>Math.floor(r/s*100)),[]);return a("div",{className:"flex justify-center  text-slate-100 text-sm ",style:{minWidth:"128px"},children:[i&&o(f,{type:"line",percent:d,strokeColor:c.colorSuccess,trailColor:c.colorError,format:e=>o("div",{className:"text-xs",children:`${r}/${s}`})}),!i&&o(f,{type:"line",percent:d,trailColor:c.colorWarning,format:e=>o("div",{className:"text-xs",children:`${r}/${s}`})})]})};let v=!1;const C=t=>{const{mode:f,pageNum:C,pageSize:w,total:S,tableScrollHeight:P,setSelectedProblems:j,selectedRowKeys:N,problemList:T,onPageChange:E,onLineClick:D,onDelete:I,onUpdate:$,fetchDone:z,setFetchDone:L,setFirst:M}=t,[R,W]=e.exports.useState([]),F=l(s),G=l(r);e.exports.useEffect((()=>{v&&T.length>0&&K(T),v=!0}),[T]),e.exports.useEffect((()=>{}),[z]);const K=async e=>{let t=0;const a=[];for(let l of e){const e=await Promise.all([m({problem_id:l.id}),m({problem_id:l.id,condition:"Accepted"}),h(l.id)]);a.push({key:(null==l?void 0:l.key)||l.id,index:(C-1)*w+t+1,title:l.title,description:l.description,totaRecords:e[0].data.data.total,accpet:e[1].data.data.total,acPerc:o(k,{total:e[0].data.data.total,accept:e[1].data.data.total}),labels:e[2].data.data.problemLabels}),t++}M&&M(!1),W(a),L(!0),v=!0},_=e=>{},A=[{title:"操作",render:(e,t,l)=>a("div",{style:{minWidth:"8rem"},children:[$&&o(i,{type:"link",size:"small",style:{padding:"0"},onClick:e=>{e.stopPropagation(),$(l)},children:"更新"}),I&&a(n,{children:[o(c,{type:"vertical"}),o(b,{title:"确认删除？",okText:"确认",cancelText:"取消",onConfirm:e=>{I(l)},children:o(i,{type:"link",style:{padding:"0"},size:"small",danger:!0,children:"删除"})})]})]})}],H={dataSource:R,columns:(()=>{const e=[{title:"标题",dataIndex:"title",render:(e,t)=>o("div",{className:x.title,onClick:()=>D(t),children:o("span",{onClick:_,children:e})})},{title:"标签",dataIndex:"labels",render:e=>o("div",{style:{width:"10rem",whiteSpace:"nowrap",overflow:"hidden"},children:e.map(((e,t)=>t<=1?o(y,{children:e.label},t):null))})},{title:"AC率",dataIndex:"acPerc",render:e=>o("div",{className:"",children:e})}];return G?e:[{title:"KEY",dataIndex:"key",render:e=>o(d,{mouseEnterDelay:.3,title:`点击复制 ${e}`,children:o("div",{className:"select-none hover:cursor-pointer",onClick:t=>((e,t)=>{t.stopPropagation(),p.copyToClipboard(e)&&F&&F.success({message:"已复制到剪切板",duration:1})})(e,t),children:o("div",{className:"w-16",children:e.slice(e.length-5)})})})},...e]})(),pageProps:{pageNum:C,pageSize:w,total:S,onPageChange:E},rowSelection:"checkbox"!==f&&"radio"!==f||!j?void 0:{type:f,columnWidth:64,selectedRowKeys:N,onChange:(e,t,a)=>{"radio"===f?j(t):"all"===a.type&&(e.length?j((e=>[...e,...t])):j((e=>[...e.filter((e=>-1===R.findIndex((t=>t.key===e.key))))])))},onSelect:(e,t)=>{j(t?t=>[...t,e]:t=>[...t.filter((t=>t.key!==e.key))])}},onRow:e=>({})};return a("div",{className:x.problemTable,children:[!z&&o(g,{style:{width:"100%"},active:!0,paragraph:{rows:w}}),z&&o(u,{..."action"===f?{...H,actions:A}:H})]})};export{C as P};
