import{d as e,i as t,m as a,bI as s,_ as l,a as o,j as r,P as n,F as d,S as c,o as i,p as h,c8 as m,bF as p}from"./index.5c064301.js";import{j as g,s as u,k as f,l as b,m as x}from"./problem.1496b552.js";import{g as S}from"./tag.c2520897.js";import{R as v}from"./Readonly.a9ebc692.js";import{c as y,g as N,a as k,s as j,e as w,f as C}from"./topic.eb4e8577.js";import{P as E}from"./ProblemTable.523975e8.js";import{M as I}from"./MyTag.a4f82d92.js";import{M as P}from"./MyCollapse.32cc964b.js";import{s as z}from"./style.module.af136287.js";import{S as M}from"./index.a45f76a6.js";import{D as T}from"./index.972659d0.js";import{I as D}from"./index.7d75d2c2.js";let F=!0;const L=e=>{F=e},R=R=>{var _,K;const{mode:$,setSelectedProblems:J,selectedRowKeys:O}=R,q=e(t),B=a.useNavTo(),{Search:H}=D,[V,A]=s(),[G,Q]=l.exports.useState(V.get("topic")||""),[U,W]=l.exports.useState(V.get("text")||""),[X,Y]=l.exports.useState(JSON.parse(V.get("labels")||"[]")),[Z,ee]=l.exports.useState(Number(V.get("pageNum")||1)),[te,ae]=l.exports.useState(Number(V.get("pageSize")||20)),[se,le]=l.exports.useState(0),[oe,re]=l.exports.useState([]),[ne,de]=l.exports.useState([]),[ce,ie]=l.exports.useState(),[he,me]=l.exports.useState([]),[pe,ge]=l.exports.useState(!1),[ue,fe]=l.exports.useState(0),[be,xe]=l.exports.useState([G]),Se=l.exports.useMemo((()=>q?"middle":"large"),[q]);l.exports.useEffect((()=>{}),[oe]),l.exports.useEffect((()=>{G||U.length||X.length?U.length||X.length||!G?U.length?ke():X.length&&je():Ne(G):ye(),G&&y(G).then((e=>{ie(e.data.data.topic)})),N().then((e=>{const t=e.data.data.topics;de(t)})),S(1,1e4).then((e=>{const t=[];e.data.data.tags.forEach((e=>t.push({label:e.tag,checked:!!X.find((t=>t===e.tag))}))),me(t)}))}),[]),l.exports.useEffect((()=>{var e;pe&&(null==(e=document.querySelector("#content"))||e.scrollTo({left:0,top:0}))}),[pe]),l.exports.useEffect((()=>{if(F)return;const e=[];he.forEach((t=>{t.checked&&e.push(t.label)})),Y(e)}),[he]);const ve=l.exports.useMemo((()=>{const e=[];return ne.forEach((t=>e.push({value:t.id,label:t.title}))),e}),[ne]);l.exports.useEffect((()=>{F||(Ce(),X.length||U.length?X.length?je():U.length?ke():we():G?Ne(G):ye(),xe([G]))}),[G]),l.exports.useEffect((()=>{F||(Ce(),U.length||(X.length||G?X.length?je():G&&Ne(G):ye()))}),[U]),l.exports.useEffect((()=>{A((e=>(e.set("labels",JSON.stringify(X)),e))),F||(Ce(),X.length?U.length?we():je():U.length||G?U.length?ke():G&&Ne(G):ye())}),[X]),l.exports.useEffect((()=>{A((e=>(e.set("pageNum",String(Z)),e.set("pageSize",String(te)),e))),G||U.length||X.length?U.length&&X.length?we():U.length?ke():X.length?je():Ne(G):ye()}),[Z,te]);const ye=e=>{ge(!1),g(Z,te).then((e=>{le(e.data.data.total),re(e.data.data.problems)}))},Ne=async e=>{ge(!1);const t=(await k(e)).data.data.problemLists;le(t.length);const a=[];for(let s=0;s<t.length;s++){const e=await u(t[s].problem_id);a.push(e.data.data.problem)}re(a)},ke=()=>{ge(!1),G?j(G,U,Z,te).then((e=>{le(e.data.data.total),re(e.data.data.problems)})):f(U,Z,te).then((e=>{le(e.data.data.total),re(e.data.data.problems)}))},je=e=>{ge(!1),G?w(G,X,Z,te).then((e=>{le(e.data.data.total),re(e.data.data.problems)})):b(X,Z,te).then((e=>{le(e.data.data.total),re(e.data.data.problems)}))},we=()=>{ge(!1),G?C(G,U,X,Z,te).then((e=>{le(e.data.data.total),re(e.data.data.problems)})):x(U,X,Z,te).then((e=>{le(e.data.data.total)}))},Ce=()=>{ee(1)};return o("div",{className:z.problemList,children:r("div",{className:"w-full",children:[r("div",{className:z.header,children:[o("div",{className:z.headerItem,children:o(M,{style:{width:"100%"},size:Se,allowClear:!0,placeholder:"选择题单",value:null==ce?void 0:ce.id,onChange:async e=>{const t=ne.find((t=>t.id===e));if(t){const e=await p(t.user_id);t.user=e.data.data.user}Ce(),Q((null==t?void 0:t.id)||""),ie(t),A((e=>(e.set("topic",(null==t?void 0:t.id)||""),e)))},options:ve})}),o("div",{className:"w-4"}),o("div",{className:z.headerItem,children:o(n,{trigger:"click",content:o("div",{className:z.labelPopover,children:he.map(((e,t)=>o("span",{onClick:()=>(e=>{const t=[...he];t[e].checked=!t[e].checked,me(t)})(t),style:{margin:"0.25rem 0",display:"inline-block"},children:o(I,{checkable:!0,checked:he[t].checked,children:e.label})},t)))}),children:o(M,{size:Se,mode:"multiple",showSearch:!1,style:{width:"100%"},allowClear:!0,maxTagCount:3,placeholder:"标签筛选",open:!1,value:X,onDeselect:e=>{const t=[...he];t[he.findIndex((t=>t.label===e))].checked=!1,me(t)},onClear:()=>{const e=[...he];e.forEach((e=>e.checked=!1)),me(e)}})})}),o("div",{className:"w-4"}),o("div",{className:z.headerItem,children:o(H,{size:Se,style:{width:"100%"},defaultValue:U,placeholder:"文本搜索",enterButton:!0,onSearch:()=>{U.length&&(Ce(),X.length?we():ke())},onChange:e=>{W(e.target.value),A((t=>(t.set("text",e.target.value),t)))}})})]}),ce&&o(P,{activeKey:be,onChange:e=>{xe((t=>t.length?[]:e))},style:{margin:"0 0 1rem 0"},items:[{key:ce.id,label:ce.title,children:o(d,{children:r(T,{size:"small",layout:"vertical",children:[o(T.Item,{label:"创建者",children:r(c,{children:[o(i,{src:`${h}/${null==(_=ce.user)?void 0:_.icon}`}),o(m,{to:"",className:"text-indigo-500 hover:text-indigo-500",children:null==(K=ce.user)?void 0:K.name})]})}),o(T.Item,{label:"创建时间",children:ce.created_at}),o(T.Item,{label:"题目总数",children:se}),""!==ce.content&&o(T.Item,{label:"题单描述",children:o(v,{html:ce.content})})]})})}]}),o("div",{className:z.setCtn,children:o(E,{mode:$,problemList:oe,pageNum:Z,pageSize:te,total:se,fetchDone:pe,setFetchDone:ge,setFirst:L,onPageChange:(e,t)=>{ee(e),ae(t)},onLineClick:e=>{const t=e.key;B(`/problemdetail/${t}/description`)},tableScrollHeight:ue,setSelectedProblems:J,selectedRowKeys:O})})]})})};export{R as P};
