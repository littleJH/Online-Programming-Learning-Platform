import{cc as a,bM as t,cv as e,_ as o,bF as s,a as r}from"./index.5c064301.js";import{m as d,j as c,a as i,b as l,c as m,e as n,f as p,h as u,n as j,o as f,p as k,q as b}from"./article.08f59da4.js";import{g as x,d as y}from"./remark.4a43720f.js";import{G as C}from"./GeneralDetail.d3509c96.js";import"./Readonly.a9ebc692.js";import"./index.4cc837d4.js";import"./MyTag.a4f82d92.js";import"./useClosable.e9e9bb76.js";import"./context.aa52cc0c.js";import"./TextEditor.53774050.js";import"./RemarkCard.b0fdd9fd.js";import"./style.module.dc2582af.js";import"./index.9225dd62.js";import"./Skeleton.ed2cb458.js";import"./PlusOutlined.787b1bb7.js";import"./Dropdown.acaf0b68.js";import"./style.module.6da86900.js";import"./index.ec27075f.js";import"./List.6e377c69.js";import"./communityStore.399498c1.js";import"./UserInfo.2df9e32c.js";import"./MyAvatar.22457dcc.js";import"./message.856d7a68.js";import"./WomanOutlined.2213c8b5.js";import"./row.e491f7a6.js";import"./index.77ceaa6f.js";import"./index.6891d53f.js";import"./ActionButton.76c967e9.js";import"./useLocale.07149357.js";import"./fade.9766c3a1.js";import"./PurePanel.bec90387.js";import"./index.7d75d2c2.js";import"./index.4e624168.js";import"./BaseInput.01760c9b.js";import"./index.79a1b64c.js";const h=()=>{const{article_id:h=""}=a(),[w,N]=t(e),[g,v]=o.exports.useState(""),[R,S]=o.exports.useState(!1);o.exports.useEffect((()=>()=>{N(null)}),[]),o.exports.useEffect((()=>{"number"!=typeof(null==w?void 0:w.likeNum)&&E(),d(h)}),[w]);const E=async()=>{const a=await Promise.all([c(h),i(h),l(h,"true"),m(h),n(h),p(h),u(h),x(h)]),t=a[0].data.data.article;t.liked=a[1].data.data.like,t.likeNum=a[2].data.data.total,t.collected=a[3].data.data.collect,t.collectNum=a[4].data.data.total,t.visibleNum=a[5].data.data.total,t.labels=a[6].data.data.articleLabels,t.remark={remarks:a[7].data.data.remarks,total:a[7].data.data.total};const e=await s(t.user_id);t.user=e.data.data.user,N(t)};return r(C,{currentObject:w,remarkContent:g,openRemarkModal:R,onArrowupClick:()=>{const a=document.createElement("a");a.href="#top",a.click()},onCollectClick:()=>{(null==w?void 0:w.collected)?b(h).then((async a=>{if(200===a.data.code&&w){const{data:a}=await n(h);N((t=>({...t,collected:!1,collectNum:a.data.total})))}})):k(h).then((async a=>{if(200===a.data.code&&w){const{data:a}=await n(h);N((t=>({...t,collected:!0,collectNum:a.data.total})))}}))},onCommentClick:()=>{const a=document.createElement("a");a.href="#remark",a.click()},onLikeClick:()=>{1===(null==w?void 0:w.liked)?f(h).then((async a=>{if(200===a.data.code&&w){const{data:a}=await l(h,"true");N((t=>({...t,liked:0,likeNum:a.data.total})))}})):j(h,"true").then((async a=>{if(200===a.data.code&&w){const{data:a}=await l(h,"true");N((t=>({...t,liked:1,likeNum:a.data.total})))}}))},onSubmitRemarkClick:()=>{y(h,JSON.stringify({content:g})).then((async a=>{if(200===a.data.code){S(!1),v("");const{data:a}=await x(h);N((t=>({...t,remark:{remarks:a.data.remarks,total:a.data.total}})))}}))},onRemarkChange:a=>v(a),onRemarkModalChange:a=>S(a)})};export{h as default};
