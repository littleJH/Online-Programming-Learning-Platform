import{s as e,k as t}from"./problem.1496b552.js";import{R as i}from"./Readonly.a9ebc692.js";import{m as a,bI as o,_ as s,j as r,a as d,aY as n,l as c,P as l,S as m,bS as p}from"./index.5c064301.js";import{P as u}from"./ProblemNew.e38b9fe8.js";import{a as f,g as j,d as b,u as h,q as x}from"./problemNew.e9465bc1.js";import{S as g}from"./index.a45f76a6.js";import{L as y}from"./index.0ec24622.js";import{I as S}from"./index.7aeb2011.js";import{M as w}from"./MinusCircleOutlined.59c26db9.js";import"./index.4cc837d4.js";import"./program.7335cc1e.js";import"./chatGpt.0470686f.js";import"./LanguageList.5e03f3ce.js";import"./CodeEditorConfig.c1285810.js";import"./index.0c9dd83b.js";import"./context.aa52cc0c.js";import"./row.e491f7a6.js";import"./useLocale.07149357.js";import"./index.05a8036e.js";import"./Highlight.c2b7293d.js";import"./recordStates.a45efd0a.js";import"./index.699f9875.js";import"./Dropdown.acaf0b68.js";import"./PurePanel.bec90387.js";import"./index.6891d53f.js";import"./ActionButton.76c967e9.js";import"./useClosable.e9e9bb76.js";import"./fade.9766c3a1.js";import"./index.4071f4af.js";import"./SwapRightOutlined.64619f65.js";import"./TextEditor.53774050.js";import"./index.7d75d2c2.js";import"./index.4e624168.js";import"./BaseInput.01760c9b.js";import"./PlusOutlined.787b1bb7.js";import"./index.4d9ca8d6.js";import"./Table.f08b7a7b.js";import"./List.6e377c69.js";import"./index.ec27075f.js";import"./Pagination.855f4d50.js";import"./index.59b8fbad.js";import"./CheckOutlined.363c4795.js";import"./progress.2cf02846.js";import"./UpOutlined.722986ed.js";let v,C;const I=()=>{const I=a.useNavTo(),[k]=o(),N=k.get("competition_id"),[O,P]=s.exports.useState([]),[L,_]=s.exports.useState(!1),[E,T]=s.exports.useState([]),[F,M]=s.exports.useState([]),[z,R]=s.exports.useState(!1);s.exports.useEffect((()=>{$()}),[N]);const $=async()=>{if(!N)return;const{data:e}=await f(N);e.data.problemIds&&e.data.problemIds.forEach((async(e,t)=>{const{data:i}=await j(e);P((e=>[...e,{id:i.data.problem.id,score:i.data.problem.score,title:i.data.problem.title,description:i.data.problem.description}]))}))},A=async e=>{if(!N)return;let t={code:0,msg:""};const{id:i,score:a}=e,{data:o}=await j(i);if(o.data){const e={...o.data.problem};e.score=a,delete e.create_at,delete e.id,delete e.updated_at,delete e.user_id,await h(i,JSON.stringify(e)).then((e=>{t={code:e.data.code,msg:e.data.msg}}))}else await x(N,i,a).then((e=>{t={code:e.data.code,msg:e.data.msg}}));t.code,p.success({message:t.msg})};return r("div",{className:"w-full",children:[d(g,{size:"large",showSearch:!0,mode:"multiple",value:F,placeholder:"Search problem ...",defaultActiveFirstOption:!1,filterOption:!1,onSearch:e=>{M([]),((e,i)=>{v&&(clearTimeout(v),v=null),C=e,e?v=setTimeout((()=>{t(e).then((t=>{if(t.data.data.problems){if(C===e){const e=t.data.data.problems.map(((e,t)=>({value:e.title,label:e.title,key:e.id})));i(e)}}else i([])}))}),300):i([])})(e,T)},onChange:e=>M(e),onSelect:t=>{e(t.key).then((e=>{P((t=>[...t,{id:e.data.data.problem.id,score:"1",title:e.data.data.problem.title,description:e.data.data.problem.description}]))}))},className:"w-full",labelInValue:!0,notFoundContent:L?d(n,{size:"small"}):null,options:E,autoFocus:!0}),d(y,{style:{width:"100%"},itemLayout:"horizontal",dataSource:O,renderItem:(e,t)=>d(s.exports.Fragment,{children:r(y.Item,{actions:[d(c,{type:"text",danger:!0,shape:"circle",onClick:()=>(e=>{P((t=>[...t.slice(0,e),...t.slice(e+1)])),b(O[e].id).then((e=>{}))})(t),icon:d(w,{})})],children:[d(y.Item.Meta,{description:d(l,{mouseEnterDelay:.3,overlayStyle:{maxWidth:"512px"},overlayInnerStyle:{maxHeight:"256px",overflow:"scroll"},title:e.title,content:d(i,{style:{},html:e.description}),children:d("div",{className:"hover:cursor-pointer text-indigo-500 min-w-max",onClick:()=>{return t=e.id,void I(`/problemdetail/${t}/description`);var t},children:e.title})})}),r("div",{className:"",children:[d("span",{children:"分数："}),d(S,{min:"0",defaultValue:e.score,onChange:e=>(async(e,t)=>{const i=[...O];i[t].score=e,P(i)})(e,t)})]})]})})}),r(m,{className:"flex justify-center",children:[d(c,{onClick:()=>I(`/creation/competition/competition?competition_id=${N}`),children:"上一步"}),d(c,{onClick:()=>{I(`/competition/common/${N}/overview`)},children:"跳转比赛详情"}),d(c,{type:"primary",onClick:()=>{for(let e of O)A(e)},children:"保存"})]}),z&&d(u,{open:z,setisModelOpen:R})]})};export{I as default};
