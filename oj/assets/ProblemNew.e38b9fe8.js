import{_ as e,j as t,a,F as r,l,S as i,w as o,bS as n}from"./index.5c064301.js";import{C as s,c as d}from"./program.7335cc1e.js";import{c}from"./problemNew.e9465bc1.js";import{T as m}from"./TextEditor.53774050.js";import{I as u,T as p}from"./index.7d75d2c2.js";import{F as h}from"./index.0c9dd83b.js";import{I as g}from"./index.7aeb2011.js";import{S as y}from"./index.a45f76a6.js";import{R as f,C as S}from"./row.e491f7a6.js";import{M as b}from"./MinusCircleOutlined.59c26db9.js";import{P as I}from"./PlusOutlined.787b1bb7.js";import{R as v}from"./index.4d9ca8d6.js";import{R as k}from"./Readonly.a9ebc692.js";import{T as _,C as x}from"./Table.f08b7a7b.js";import{M as C}from"./index.6891d53f.js";import{S as j}from"./index.59b8fbad.js";import{R as F}from"./index.4071f4af.js";const N={title:"",description:"",time_limit:"",time_unit:"",memory_limit:"",memory_unit:"",input:"",output:"",sample_case:{input:"",output:""},test_case:{input:"",output:""},hint:"",source:""};let w=N;const q=i=>{const{form:o}=i,{Option:n}=y;e.exports.useEffect((()=>{w=localStorage.getItem("problemForm")?JSON.parse(localStorage.getItem("problemForm")):N,o.setFieldsValue(w)}),[]);const s=(e,t)=>{o.setFieldValue(t,e)};return t(h,{form:o,name:"problemForm",layout:"vertical",onValuesChange:()=>{const e=o.getFieldsValue();localStorage.setItem("problemForm",JSON.stringify(e))},scrollToFirstError:!0,children:[a(h.Item,{name:"title",label:"标题",rules:[{required:!0}],children:a(u,{})}),a(h.Item,{name:"description",label:"描述",rules:[{required:!0}],children:a(m,{mode:"markdown",htmlChange:e=>s(e,"description"),defaultHtml:w.description})}),a(h.Item,{label:"限制",name:"limit",rules:[{required:!0}],children:t(f,{gutter:12,children:[a(S,{span:12,children:a(h.Item,{name:"time_limit",noStyle:!0,rules:[{required:!0}],children:a(g,{min:1,placeholder:"时间限制",addonAfter:a(h.Item,{name:"time_unit",rules:[{required:!0}],noStyle:!0,children:t(y,{placeholder:"请选择",style:{width:80},children:[a(n,{value:"s",children:"s"}),a(n,{value:"ms",children:"ms"})]})})})})}),a(S,{span:12,children:a(h.Item,{name:"memory_limit",noStyle:!0,rules:[{required:!0}],children:a(g,{min:1,placeholder:"空间限制",addonAfter:a(h.Item,{name:"memory_unit",rules:[{required:!0}],noStyle:!0,children:t(y,{placeholder:"请选择",style:{width:80},children:[a(n,{value:"kb",children:"kb"}),a(n,{value:"mb",children:"mb"}),a(n,{value:"gb",children:"gb"})]})})})})})]})}),a(h.Item,{name:"input",label:"输入格式",rules:[{required:!0}],children:a(m,{mode:"markdown",defaultHtml:w.input,htmlChange:e=>s(e,"input")})}),a(h.Item,{name:"output",label:"输出格式",rules:[{required:!0}],children:a(m,{mode:"markdown",defaultHtml:w.output,htmlChange:e=>s(e,"output")})}),a(h.Item,{label:"示例",required:!0,children:t(f,{gutter:16,children:[a(S,{span:12,children:a(h.Item,{name:["sample_case","input"],noStyle:!0,rules:[{required:!0}],children:a(p,{placeholder:"input",autoSize:!0})})}),a(S,{span:12,children:a(h.Item,{name:["sample_case","output"],noStyle:!0,rules:[{required:!0}],children:a(p,{placeholder:"output",autoSize:!0})})})]})}),a(h.List,{name:"sample_case_expand",children:(e,{add:i,remove:o},{errors:n})=>t(r,{children:[e.map(((e,r,l)=>a(h.Item,{colon:!1,label:a(b,{className:"dynamic-delete-button",onClick:()=>o(e.name)}),children:a(h.Item,{noStyle:!0,children:t(f,{gutter:16,children:[a(S,{span:12,children:a(h.Item,{name:[r,"input"],noStyle:!0,children:a(p,{placeholder:"input",autoSize:!0})})}),a(S,{span:12,children:a(h.Item,{name:[r,"output"],noStyle:!0,children:a(p,{placeholder:"output",autoSize:!0})})})]})})},e.key))),a(h.Item,{colon:!1,style:{width:"100%"},children:a(l,{className:"text-slate-500",type:"dashed",onClick:()=>i(),style:{width:"100%"},icon:a(I,{}),children:"示例"})})]})}),a(h.Item,{label:"用例",required:!0,children:t(f,{gutter:16,children:[a(S,{span:12,children:a(h.Item,{noStyle:!0,name:["test_case","input"],rules:[{required:!0}],children:a(p,{placeholder:"input",autoSize:!0})})}),a(S,{span:12,children:a(h.Item,{noStyle:!0,name:["test_case","output"],rules:[{required:!0}],children:a(p,{placeholder:"output",autoSize:!0})})})]})}),a(h.List,{name:"test_case_expand",children:(e,{add:i,remove:o},{errors:n})=>t(r,{children:[e.map(((e,r,l)=>a(h.Item,{colon:!1,label:a(b,{className:"dynamic-delete-button",onClick:()=>o(e.name)}),children:a(h.Item,{noStyle:!0,children:t(f,{gutter:16,children:[a(S,{span:12,children:a(h.Item,{noStyle:!0,name:[r,"input"],rules:[{required:!0}],children:a(p,{placeholder:"input",autoSize:!0})})}),a(S,{span:12,children:a(h.Item,{noStyle:!0,name:[r,"output"],rules:[{required:!0}],children:a(p,{placeholder:"output",autoSize:!0})})})]})})},e.key))),a(h.Item,{colon:!1,children:a(l,{className:"text-slate-500",type:"dashed",onClick:()=>i(),style:{width:"100%"},icon:a(I,{}),children:"用例"})})]})}),a(h.Item,{name:"hint",label:"提示",children:a(m,{mode:"markdown",defaultHtml:w.hint,htmlChange:e=>s(e,"hint")})}),a(h.Item,{name:"source",label:"来源",children:a(m,{mode:"markdown",defaultHtml:w.source,htmlChange:e=>s(e,"source")})})]})},H="_label_1hjvm_1",O=r=>{const{setcode1:l,setcode2:o,programMode:n,setprogramMode:d,setcodeLanguage:c}=r;return e.exports.useEffect((()=>{const e=localStorage.getItem("code1"),t=localStorage.getItem("code2");l(e||""),o(t||"")}),[]),t(i,{direction:"vertical",className:"w-full",children:[t("div",{children:[a("p",{className:H,children:"类型"}),a(v.Group,{defaultValue:"standard",optionType:"button",onChange:e=>{d(e.target.value)},options:[{label:a("div",{children:"标准程序"}),value:"standard"},{label:a("div",{children:"特判程序"}),value:"special_judge"},{label:a("div",{children:"标准Hack程序"}),value:"standardHack"},{label:a("div",{children:"特判Hack程序"}),value:"specialHack"}]})]}),a("p",{className:H,children:"程序"}),t(e.exports.Fragment,{children:[("specialHack"===n||"standardHack"===n)&&t("div",{className:"flex items-center my-2",children:[a("div",{className:"serial",children:"1"}),a("div",{children:" 创建标准程序"})]}),a(s,{oj:"",value:localStorage.getItem("code1")?localStorage.getItem("code1"):"",codeChange:e=>{l(e),localStorage.setItem("code1",e)},height:512,onLanguageChange:e=>c(e)})]}),("specialHack"===n||"standardHack"===n)&&t(e.exports.Fragment,{children:[t("div",{className:"flex items-center my-2",children:[a("div",{className:"serial",children:"2"}),a("div",{children:" 创建输入检测程序"})]}),a(s,{oj:"",value:localStorage.getItem("code2")?localStorage.getItem("code2"):"",codeChange:e=>{o(e),localStorage.setItem("code2",e)},height:512})]}),a("div",{className:"h-8"})]})},V=r=>{const l=r.form.getFieldsValue(!0),i=e.exports.useMemo((()=>{const e=[];return Object.keys(l).forEach(((t,a)=>{e.push({key:t,value:l[t]})})),e}),[]);return t("div",{children:[t(_,{className:"rounded shadow",bordered:!0,showHeader:!1,dataSource:i,pagination:!1,children:[a(x,{title:"key",dataIndex:"key"},"key"),a(x,{width:800,title:"value",dataIndex:"value",render:(e,t)=>{switch(typeof e){case"string":return a(k,{className:"p-4",html:e.includes("<p>")?e:`<p>${e}<p/>`});case"object":return}}},"value")]}),a("div",{className:"h-8"})]})},z=["test_input","test_output","sample_input","sample_output"],M={title:"",description:"",time_limit:"",time_unit:"",memory_limit:"",memory_unit:"",input:"",output:"",sample_case:{input:"",output:""},test_case:{input:"",output:""},hint:"",source:""},J=r=>{const[i]=h.useForm(),{open:s,setisModelOpen:m}=r,[u,p]=o.useState("process"),[g,y]=o.useState(0),[f,S]=o.useState("standard"),[b,I]=o.useState(M),[v,k]=o.useState(),[_,x]=o.useState("cpp"),[N,w]=o.useState(""),[H,J]=o.useState("");e.exports.useLayoutEffect((()=>{if(0===g){const e=localStorage.getItem("problemForm")?JSON.parse(localStorage.getItem("problemForm")):M;I(e),i.setFieldsValue(e)}else 1===g&&(w(localStorage.getItem("code1")?localStorage.getItem("code1"):""),J(localStorage.getItem("code2")?localStorage.getItem("code2"):""))}),[g]);const E=()=>{switch(g){case 0:i.validateFields().then((e=>{localStorage.setItem("problemForm",JSON.stringify(i.getFieldsValue())),y((e=>e+1))})).catch((()=>{n.warning({message:"请完善表单"})}));break;case 1:const e=JSON.stringify({language:"C++",code:N}),t=JSON.stringify({language:"C++",code:H});"standard"===f||"special_judge"===f?d(e).then((e=>{if(200!==e.data.code)return void n.warning({message:e.data.msg});const t=e.data.data.program.id;"standard"===f?i.setFieldValue("standard",t):i.setFieldValue("special_judge",t),y((e=>e+1))})):Promise.all([d(e),d(t)]).then((e=>{if(200!==e[0].data.code)return void n.warning({message:e[0].data.msg});const t=e[0].data.data.program.id,a=e[1].data.data.program.id;"standardHack"===f?i.setFieldValue("standard",t):i.setFieldValue("special_judge",t),i.setFieldValue("input_check",a),y((e=>e+1))}));break;case 2:const a=Object.assign({competition_id:""},i.getFieldsValue(!0));Object.keys(a).forEach((e=>{"string"!=typeof a[e]&&(a[e]=JSON.stringify(a[e])),z.includes(e)&&(a[e]=a[e].split(" ")),["memory_limit","time_limit"].includes(e)&&(a[e]=Number(a[e]))})),c(JSON.stringify(a)).then((e=>{200===e.data.code?(localStorage.removeItem("problemForm"),localStorage.removeItem("code1"),localStorage.removeItem("code2"),p("finish")):(k(e.data.msg),p("error"))}))}};return a("div",{children:a(C,{className:"min-w-max",title:"创建赛内题目",open:s,onCancel:()=>{m(!1)},footer:[a(l,{type:"primary",children:"上一步"}),a(l,{type:"primary",children:"下一步"})],children:t("div",{style:{width:"1000px"},className:"flex flex-col items-center",children:[a("div",{className:"p-8 w-2/3",children:a(j,{status:u,current:g,items:[{title:"创建题目",description:""},{title:"创建程序",description:""},{title:"提交",description:""}]})}),0===g&&a(q,{form:i}),1===g&&a(O,{codeLanguage:_,setcode1:w,setcode2:J,programMode:f,setprogramMode:S,setcodeLanguage:x}),2===g&&"process"===u&&a(V,{form:i}),"finish"===u&&a(F,{status:"success",title:"题目创建成功！",extra:[a(l,{type:"primary",onClick:()=>{y(0),p("process")},children:"继续创建下一题"},"0"),a(l,{type:"primary",onClick:()=>{},children:"查看题目详情"},"1")]}),"error"===u&&a(F,{status:"error",title:v,extra:[a(l,{onClick:()=>{y(1),p("process")},children:'返回“创建程序"'},"2"),a(l,{onClick:()=>{y(0),p("process")},children:'返回“创建题目"'},"1")]}),"process"===u&&t("div",{children:[0===g&&a(l,{size:"large",type:"primary",onClick:()=>E(),children:"下一步"}),1===g&&t(e.exports.Fragment,{children:[a(l,{size:"large",onClick:()=>{y((e=>e-1))},children:"上一步"}),a(l,{size:"large",type:"primary",onClick:()=>E(),children:"下一步"})]}),2===g&&t(e.exports.Fragment,{children:[a(l,{size:"large",onClick:()=>{y((e=>e-1))},children:"上一步"}),a(l,{size:"large",type:"primary",onClick:E,children:"提交"})]})]})]})})})};export{J as P};
